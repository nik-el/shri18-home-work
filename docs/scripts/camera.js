const MAGIC_VOLUME_COEFFICIENT=22,initVideo=(a,b)=>{if(console.log("Hls.isSupported",Hls.isSupported),Hls.isSupported()){var c=new Hls;c.loadSource(b),c.attachMedia(a),c.on(Hls.Events.MANIFEST_PARSED,function(){a.play()})}else a.canPlayType("application/vnd.apple.mpegurl")&&(a.src=b,a.addEventListener("loadedmetadata",function(){a.play()}))};let requestId;const context=new(window.AudioContext||window.webkitAudioContext),analyser=context.createAnalyser(),destination=context.destination;analyser.fftSize=128;const bTimeData=new Uint8Array(analyser.frequencyBinCount);analyser.getByteTimeDomainData(bTimeData),analyser.connect(destination);const modal=document.querySelector(".modal"),modalControls=document.querySelector(".modal__controls"),modalReturn=document.querySelector(".modal__button--return"),modalContrast=document.querySelector(".modal__contrast"),modalBrightness=document.querySelector(".modal__brightness"),volumeModal=document.querySelector(".modal__volume"),cameras=document.querySelectorAll(".camera"),openModal=a=>{const b=document.getElementById(`video-${a}`);modal.insertBefore(b,modalControls),b.play(),b.setAttribute("controls",""),b.muted=!1,initSettings("contrast",b),initSettings("brightness",b),modal.classList.add("modal--show")},getVolume=a=>{let b=0;a.forEach(a=>{b+=a});const c=b/a.length;return c},closeModal=()=>{const a=document.querySelector(".modal .camera__video"),b=a.dataset.id,c=document.querySelector(`.camera--${b}`);c.appendChild(a),a.play(),a.muted=!0,a.removeAttribute("controls"),modal.classList.remove("modal--show"),cancelAnimationFrame(requestId)};modalContrast.addEventListener("input",a=>{changeSettings(a.target.value,"contrast")}),modalBrightness.addEventListener("input",a=>{changeSettings(a.target.value,"brightness")});const initSettings=(a,b)=>{const c=b.style.filter.split(" ");c.forEach(b=>{if(b.split("(")[0]===a)if("contrast"===a){const c=document.querySelector(`.modal__${a}-value`);modalContrast.value=b.split("(").pop().split("%")[0]/2,c.innerText=`${a}: ${2*modalContrast.value}%`}else if("brightness"===a){const c=document.querySelector(`.modal__${a}-value`);modalBrightness.value=b.split("(").pop().split("%")[0]/2,c.innerText=`${a}: ${2*modalBrightness.value}%`}}),b.style.filter=c.join(" ")},changeSettings=(a,b)=>{const c=document.querySelector(`.modal__${b}-value`),d=document.querySelector(".modal .camera__video"),e=d.style.filter.split(" ");e.forEach((c,d)=>{c.split("(")[0]===b&&(e[d]=`${b}(${2*a}%)`)}),d.style.filter=e.join(" "),c.innerText=`${b}: ${2*a}%`};cameras.forEach(a=>{const b=a.querySelector(".camera__video"),c=context.createMediaElementSource(b);c.connect(analyser);const d=()=>{analyser.getByteTimeDomainData(bTimeData);let a=(128-getVolume(bTimeData))*MAGIC_VOLUME_COEFFICIENT;volumeModal.style.width=a.toFixed(4)+"%",requestId=requestAnimationFrame(d)};a.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),openModal(a.target.dataset.id),d(a.target.dataset.id)})}),modalReturn.addEventListener("click",()=>{closeModal()}),window.addEventListener("keydown",a=>{"Escape"===a.key&&modal.classList.contains("modal--show")&&closeModal()}),initVideo(document.getElementById("video-1"),"http://localhost:9191/master?url=http%3A%2F%2Flocalhost%3A3102%2Fstreams%2Fdog%2Fmaster.m3u8"),initVideo(document.getElementById("video-2"),"http://localhost:9191/master?url=http%3A%2F%2Flocalhost%3A3102%2Fstreams%2Fcat%2Fmaster.m3u8"),initVideo(document.getElementById("video-3"),"http://localhost:9191/master?url=http%3A%2F%2Flocalhost%3A3102%2Fstreams%2Fsosed%2Fmaster.m3u8"),initVideo(document.getElementById("video-4"),"http://localhost:9191/master?url=http%3A%2F%2Flocalhost%3A3102%2Fstreams%2Fhall%2Fmaster.m3u8");